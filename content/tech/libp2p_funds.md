---
title: "Libp2p_funds"
date: 2023-01-11T13:45:27+08:00
draft: false
---

libp2p 是一个模块化的协议、规范和库系统，支持p2p网络应用程序的开发。

libp2p 允许所有用户保留他们的网络身份，克服网络审查，并通过不同的传输协议进行通信。尽管 libp2p 源于 IPFS，但它并不依赖于 IPFS，如今，许多项目都使用 libp2p作为其网络层（例如以太坊）。

![libp2p](/img/posts/libp2p.png)

## Ping协议
libp2p中的ping协议与传统的网络层（ICMP）中的ping有所不同。libp2p中的ping是一种简单的“活性”检查，通过ping来测试两个对等方的连接与性能，而且它需要一个已经建立的libp2p连接。

> 而ICMP ping是一个网络工具，使用ICMP数据包来检查两个联网设备之间的连接与延迟。常用于检查IP网络上主机的可达性，以及两个主机之间的数据包往返时间。

## 寻址
由于libp2p被设计的目的是能够在不同的网络中工作，所以需要一种一致的方式来处理不同的寻址方案。

"**MultiAddress**"，就是一种寻址路径的约定，它使用结构化的人类可读与机器优化的通用协议编码，将多个寻址层组合在一起。例如："/ip4/127.0.0.1/udp/1234"，很容易看出来其网络层为ipv4，ip地址是127.0.0.1，传输层协议为udp，端口号为1234。

更进一步，要认证一个p2p节点，可以使用："/p2p/QmYyQSo1c1Ym7orWxLYvCrM2EmxFTANf8wXmmE7DWjhx5N"，p2p为协议id，后面为节点公钥的"multihash"，一种自描述哈希值，也称其为"**PeerId**"。

不同的协议可以构成不同的地址，例如"relay circuit"协议：
"/ip4/7.7.7.7/tcp/4242/p2p/QmRelay/p2p-circuit/p2p/QmRelayedPeer"。

## 协议
libp2p中有各种各样的协议，这是构建p2p网络的核心。

### 基本要素
libp2p协议包含以下核心要素：
1. **协议ID**
   协议 ID 具有类似路径的结构，版本号作为最终部件
   "/my-app/amazing-protocol/1.0.1"
   
2. **处理器函数(Handler function)**
   为了接受连接，libp2p 应用程序将使用协议 ID 和"switch"（又名"swarm"）或更高级别的接口（例如 go 的 Host 接口）注册协议的处理函数。
   当一个即将到来的流（stream）被标记为注册的协议ID时，处理器函数就会被调用。
   
3. **二进制流(Binary streams)**
   libp2p协议传输的“介质”具有以下特点
   - 双向、可靠的二进制数据传输
	   - 每一方都能随时从流中读取和写入数据
	   - 数据的读取顺序与写入顺序相同
	   - 可以是“半封闭”，即写封闭读开放，或者读封闭写开放

libp2p 将确保流的安全和高效多路复用，二进制数据的格式以及何时以及由谁发送什么的机制都由协议决定。

### 协议的协商
一方请求发起一个新的流时，libp2p会发送要使用的协议id，接收方会检查该id。如果其不支持该id，它将结束该流。如果支持该协议，则对等方将回显协议ID，未来通过流发送的数据将使用约定的协议语义的信号。这个过程称作**协议协商**。
